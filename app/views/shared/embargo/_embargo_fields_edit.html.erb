<% if accessRights.empty? %>
  <% accessRights.build %>
<% end %>
<% if accessRights[0].embargoDate.empty? %>
  <% accessRights[0].embargoDate.build %>
<% end %>
<% if accessRights[0].embargoDate[0].start.empty? %>
  <% accessRights[0].embargoDate[0].start.build %>
<% end %>
<% if accessRights[0].embargoDate[0].duration.empty? %>
  <% accessRights[0].embargoDate[0].duration.build %>
<% end %>
<% if accessRights[0].embargoDate[0].end.empty? %>
  <% accessRights[0].embargoDate[0].end.build %>
<% end %>

<% startOption = nil %>
<% if accessRights[0].embargoDate[0].start[0].label[0].nil? %>
  <% startOption = "Today" %>
<% else %>
  <% startOption = accessRights[0].embargoDate[0].start[0].label[0] %>
<% end %>

<%= f.fields_for :accessRights do |f_a| %>

<% panel_id = SecureRandom.uuid %>



<div class="fieldset">

  <% if embargo_type == "metadata" %>
    <h4>Access conditions for the catalogue record</h4>
    <h5>Can this ORA catalogue record be made freely available?</h5>
  <% else %>
    <h5>Can this file be made freely available?</h5>
  <% end %>

  <fieldset class="small-text">
    <label>
      <%= f_a.radio_button :embargoStatus, "Open access", :checked => (accessRights[0].embargoStatus[0] == "Open access"), data: {"progress" => "documentation"}, :class => "required"  %>
      <span></span>Yes
    </label>
    <label panel='dataset-embargo-<%= panel_id %>'>
      <%= f_a.radio_button :embargoStatus, "Embargoed", :checked => (accessRights[0].embargoStatus[0] == "Embargoed"), data: {"progress" => "documentation"}, :class => "required" %>
      <span></span>After a certain period
    </label>
    <label>
      <%= f_a.radio_button :embargoStatus, "Closed access", :checked => (accessRights[0].embargoStatus[0] == "Closed access"), data: {"progress" => "documentation"}, :class => "required" %>
      <span></span>No
    </label>
  </fieldset>

<% if embargo_type == "metadata" %>
    <aside class="tooltip tooltip-wide">
      <a href="#" class="close-button">x</a>
      <strong>Catalogue visibility</strong>
      <p>The catalogue record for your dataset will normally be made publicly visible and openly accessible, even if the data files themselves are embargoed.
          In a small number of exceptional cases, it may be necessary to embargo and hide from public view the record as well as the data files.
          Please let us know which you would prefer.</p>
      <div class="tooltip-extra">
        <div class="circle circle-documentation"></div>
        <p><strong>Completing this field helps with Documentation, access & re-use</strong></p>
      </div>
    </aside>
<% else %>
  <aside class="tooltip">
    <a href="#" class="close-button">x</a>
    <strong>Make freely available</strong>
    <p>Select whether the file should be made openly available in ORA, or set an embargo if its
    not to be made available either for a set period or in perpetuity. You should set this information
    for each dataset file you upload.</p>
    <div class="tooltip-extra">
      <div class="circle circle-documentation"></div>
      <p><strong>Completing this field helps with Documentation, access & re-use</strong></p>
    </div>
  </aside>
<% end %>
</div>

<div class="expand-panel" id="dataset-embargo-<%= panel_id %>">

  <%= render partial: 'shared/embargo/embargo_inside_fields_edit', :locals => { :f => f, :f_a => f_a, :accessRights => accessRights, :startOption => startOption } %>
  
<% if false %>

  <h5>Can this catalogue record be made visible?</h5>

  <div class="fieldset" style="margin-bottom: 30px">
    <div class="row">
      <label>
        <input type="radio" name="temp1"/><span></span> Yes
      </label>
      <label>
        <input type="radio" name="temp1"/><span></span> No
      </label>
    </div><!-- /row -->

  </div><!-- /fieldset -->
<% end %>
<% end %>

